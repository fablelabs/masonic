function e(){return(e=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function t(e,t){function r(){n(0)}void 0===e&&(e=0),void 0===t&&(t=12);var i=b(t),[o,n]=x(0),a=C(0);return y(()=>{1===a.current&&n(1);var e=z(r,40+1e3/t);return a.current=1,()=>T(e)},[t,i]),{scrollTop:Math.max(0,i-e),isScrolling:o}}function r(){var e=x(N)[1];return C(()=>e({})).current}function i(e){var t,{positioner:i,resizeObserver:n,items:a,as:s="div",id:l,key:h,className:v,style:u,role:f="grid",tabIndex:d=0,containerRef:c,itemAs:m="div",itemStyle:p,itemHeightEstimate:g=300,itemKey:P=o,overscanBy:x=2,scrollTop:C,isScrolling:R,height:L,render:w,onRender:M}=e,b=0,z=r(),T=U(i,n),k=a.length,{columnWidth:I,columnCount:W,range:O,estimateHeight:j,size:S,shortestColumn:A}=i,B=S(),E=A(),N=[],D="list"===f?"listitem":"grid"===f?"gridcell":void 0,V=H(M),X=C+(x*=L),Y=X>E&&k>B;if(O(Math.max(0,C-x/2),X,(e,r,i)=>{var o=a[e],n=P(o,e),s={top:i,left:r,width:I,writingMode:"horizontal-tb",position:"absolute"};N.push(G(m,{key:n,ref:T(e),role:D,style:"object"==typeof p&&null!==p?Object.assign({},s,p):s},q(w,e,o,I))),void 0===t?(b=e,t=e):(b=Math.min(b,e),t=Math.max(t,e))}),Y)for(var Z=Math.min(k-B,Math.ceil((C+x-E)/g*W)),$=B,_=Q(I);B+Z>$;$++){var ee=a[$],te=P(ee,$);N.push(G(m,{key:te,ref:T($),role:D,style:"object"==typeof p?Object.assign({},_,p):_},q(w,$,ee,I)))}y(()=>{"function"==typeof V.current&&void 0!==t&&V.current(b,t,a),K="1"},[b,t,a,V]),y(()=>{Y&&z()},[Y]);var re=F(R,j(k,g));return G(s,{ref:c,key:(h||"")+"-"+K,id:l,role:f,className:v,tabIndex:d,style:"object"==typeof u?J(re,u):re,children:N})}function o(e,t){return t}function n(e){var{scrollTop:r,isScrolling:o}=t(e.offset,e.scrollFps);return i({scrollTop:r,isScrolling:o,positioner:e.positioner,resizeObserver:e.resizeObserver,items:e.items,onRender:e.onRender,as:e.as,id:e.id,className:e.className,style:e.style,role:e.role,tabIndex:e.tabIndex,containerRef:e.containerRef,itemAs:e.itemAs,itemStyle:e.itemStyle,itemHeightEstimate:e.itemHeightEstimate,itemKey:e.itemKey,overscanBy:e.overscanBy,height:e.height,render:e.render})}function a(e,t){void 0===t&&(t=V);var[r,i]=x({offset:0,width:0});return O(()=>{var{current:t}=e;if(null!==t){var o=0,n=t;do{o+=n.offsetTop||0,n=n.offsetParent}while(n);o===r.offset&&t.offsetWidth===r.width||i({offset:o,width:t.offsetWidth})}},t),r}function s(e){function t(){return o.disconnect()}var i=r(),o=X(e,i);return y(()=>t,[o]),o}function l(e){var t=e.high;e.L===Y&&e.R===Y?e.max=t:e.L===Y?e.max=Math.max(e.R.max,t):e.R===Y?e.max=Math.max(e.L.max,t):e.max=Math.max(Math.max(e.L.max,e.R.max),t)}function h(e){for(var t=e;t.P!==Y;)l(t.P),t=t.P}function v(e,t){if(t.R!==Y){var r=t.R;t.R=r.L,r.L!==Y&&(r.L.P=t),r.P=t.P,t.P===Y?e.root=r:t===t.P.L?t.P.L=r:t.P.R=r,r.L=t,t.P=r,l(t),l(r)}}function u(e,t){if(t.L!==Y){var r=t.L;t.L=r.R,r.R!==Y&&(r.R.P=t),r.P=t.P,t.P===Y?e.root=r:t===t.P.R?t.P.R=r:t.P.L=r,r.R=t,t.P=r,l(t),l(r)}}function f(e,t,r){t.P===Y?e.root=r:t===t.P.L?t.P.L=r:t.P.R=r,r.P=t.P}function d(){var e={root:Y,size:0},t={};return{insert(r,i,o){for(var n=e.root,a=Y;n!==Y&&r!==(a=n).low;)n=r<n.low?n.L:n.R;if(r===a.low&&a!==Y){if(!function(e,t,r){for(var i,o=e.list;o;){if(o.index===r)return 0;if(t>o.high)break;i=o,o=o.next}return i||(e.list={index:r,high:t,next:o}),i&&(i.next={index:r,high:t,next:i.next}),1}(a,i,o))return;return a.high=Math.max(a.high,i),l(a),h(a),t[o]=a,void e.size++}var s={low:r,high:i,max:i,C:0,P:a,L:Y,R:Y,list:{index:o,high:i,next:null}};a===Y?e.root=s:(s.low<a.low?a.L=s:a.R=s,h(s)),function(e,t){for(var r;0===t.P.C;)t.P===t.P.P.L?0===(r=t.P.P.R).C?(t.P.C=1,r.C=1,t.P.P.C=0,t=t.P.P):(t===t.P.R&&v(e,t=t.P),t.P.C=1,t.P.P.C=0,u(e,t.P.P)):0===(r=t.P.P.L).C?(t.P.C=1,r.C=1,t.P.P.C=0,t=t.P.P):(t===t.P.L&&u(e,t=t.P),t.P.C=1,t.P.P.C=0,v(e,t.P.P));e.root.C=1}(e,s),t[o]=s,e.size++},remove(r){var i=t[r];if(void 0!==i){delete t[r];var o=function(e,t){var r=e.list;if(r.index===t)return null===r.next?0:(e.list=r.next,1);var i=r;for(r=r.next;null!==r;){if(r.index===t)return i.next=r.next,1;i=r,r=r.next}}(i,r);if(void 0!==o){if(1===o)return i.high=i.list.high,l(i),h(i),void e.size--;var n,a=i,s=a.C;i.L===Y?(n=i.R,f(e,i,i.R)):i.R===Y?(n=i.L,f(e,i,i.L)):(s=(a=function(e){for(;e.L!==Y;)e=e.L;return e}(i.R)).C,n=a.R,a.P===i?n.P=a:(f(e,a,a.R),a.R=i.R,a.R.P=a),f(e,i,a),a.L=i.L,a.L.P=a,a.C=i.C),l(n),h(n),1===s&&function(e,t){for(var r;t!==Y&&1===t.C;)t===t.P.L?(0===(r=t.P.R).C&&(r.C=1,t.P.C=0,v(e,t.P),r=t.P.R),1===r.L.C&&1===r.R.C?(r.C=0,t=t.P):(1===r.R.C&&(r.L.C=1,r.C=0,u(e,r),r=t.P.R),r.C=t.P.C,t.P.C=1,r.R.C=1,v(e,t.P),t=e.root)):(0===(r=t.P.L).C&&(r.C=1,t.P.C=0,u(e,t.P),r=t.P.L),1===r.R.C&&1===r.L.C?(r.C=0,t=t.P):(1===r.L.C&&(r.R.C=1,r.C=0,v(e,r),r=t.P.L),r.C=t.P.C,t.P.C=1,r.L.C=1,u(e,t.P),t=e.root));t.C=1}(e,n),e.size--}}},search(t,r,i){for(var o=[e.root];0!==o.length;){var n=o.pop();if(n!==Y&&t<=n.max&&(n.L!==Y&&o.push(n.L),n.R!==Y&&o.push(n.R),n.low<=r&&n.high>=t))for(var a=n.list;null!==a;)a.high<t||i(a.index,n.low),a=a.next}},get size(){return e.size}}}function c(e,t){var{width:r,columnWidth:i=200,columnGutter:o=0,columnCount:n}=e;void 0===t&&(t=ee);var a=()=>{var[e,t]=_(r,i,o,n);return Z(t,e,o)},s=C();void 0===s.current&&(s.current=a());var l=C(t),h=[r,i,o,n],v=C(h),u=!h.every((e,t)=>v.current[t]===e);if(u||!t.every((e,t)=>l.current[t]===e)){var f=s.current,d=a();if(l.current=t,v.current=h,u)for(var c=f.size(),m=0;c>m;m++){var p=f.get(m);d.set(m,void 0!==p?p.height:0)}s.current=d}return s.current}function m(e,t){var r,{align:i="top",element:o="undefined"!=typeof window&&window,offset:n=0,height:a=("undefined"!=typeof window?window.innerHeight:0)}=t,s=H({positioner:e,element:o,align:i,offset:n,height:a}),l=C(()=>{var e=s.current.element;return e&&"current"in e?e.current:e}).current,[h,v]=L((e,t)=>{var r,i={position:e.position,index:e.index,prevTop:e.prevTop};if("scrollToIndex"===t.type)return{position:s.current.positioner.get(null!==(r=t.value)&&void 0!==r?r:-1),index:t.value,prevTop:void 0};if("setPosition"===t.type)i.position=t.value;else if("setPrevTop"===t.type)i.prevTop=t.value;else if("reset"===t.type)return te;return i},te),u=B(v,15);A(l(),"scroll",()=>{if(!h.position&&h.index){var e=s.current.positioner.get(h.index);e&&v({type:"setPosition",value:e})}});var f=void 0!==h.index&&(null===(r=s.current.positioner.get(h.index))||void 0===r?void 0:r.top);return y(()=>{var e=l();if(e){var{height:t,align:r,offset:i,positioner:o}=s.current;if(h.position){var n=h.position.top;"bottom"===r?n=n-t+h.position.height:"center"===r&&(n-=(t-h.position.height)/2),e.scrollTo(0,Math.max(0,n+=i));var a=0,f=setTimeout(()=>!a&&v({type:"reset"}),400);return()=>{a=1,clearTimeout(f)}}if(void 0!==h.index){var d=o.shortestColumn()/o.size()*h.index;h.prevTop&&(d=Math.max(d,h.prevTop+t)),e.scrollTo(0,d),u({type:"setPrevTop",value:d})}}},[f,h,s,l,u]),C(e=>{v({type:"scrollToIndex",value:e})}).current}function p(e){var t=C(null),r=M({initialWidth:e.ssrWidth,initialHeight:e.ssrHeight}),i=a(t,r),o=Object.assign({offset:i.offset,width:i.width||r[0],height:r[1],containerRef:t},e);o.positioner=c(o),o.resizeObserver=s(o.positioner);var l=m(o.positioner,{height:o.height,offset:i.offset,align:"object"==typeof e.scrollToIndex?e.scrollToIndex.align:void 0}),h=e.scrollToIndex&&("number"==typeof e.scrollToIndex?e.scrollToIndex:e.scrollToIndex.index);return y(()=>{void 0!==h&&l(h)},[h,l]),re(n,o)}function g(t){return ie(p,e({role:"list",columnGutter:t.rowGutter,columnCount:1,columnWidth:1},t))}function P(e,t){void 0===t&&(t=ne);var{isItemLoaded:r,minimumBatchSize:i=16,threshold:o=16,totalItems:n=9e9}=t,a=H(e),s=H(r);return w((e,t,r)=>{for(var l=function(e,t,r,i,o,n){void 0===e&&(e=oe),void 0===t&&(t=16),void 0===i&&(i=9e9);for(var a,s,l=[],h=o;n>=h;h++)e(h,r)?void 0!==a&&void 0!==s&&(l.push(a,s),a=s=void 0):(s=h,void 0===a&&(a=h));if(void 0!==a&&void 0!==s){var v=Math.min(Math.max(s,a+t-1),i-1);for(h=s+1;v>=h&&!e(h,r);h++)s=h;l.push(a,s)}if(l.length)for(var u=l[0],f=l[1];t>f-u+1&&u>0;){var d=u-1;if(e(d,r))break;l[0]=u=d}return l}(s.current,i,r,n,Math.max(0,e-o),Math.min(n-1,(t||0)+o)),h=0;h<l.length-1;++h)a.current(l[h],l[++h],r)},[n,i,o,a,s])}import{useState as x,useRef as C,useEffect as y,createElement as R,useReducer as L,useCallback as w}from"react";import{useWindowSize as M}from"@react-hook/window-size";import b from"@react-hook/window-scroll";import{requestTimeout as z,clearRequestTimeout as T}from"@essentials/request-timeout";import k from"trie-memoize";import I from"@essentials/one-key-map";import W from"@essentials/memoize-one";import H from"@react-hook/latest";import O from"@react-hook/passive-layout-effect";import j from"resize-observer-polyfill";import S from"raf-schd";import A from"@react-hook/event";import{useThrottleCallback as B}from"@react-hook/throttle";var E=new WeakMap,N={},G=R,K="0",q=k([I,{},WeakMap,I],(e,t,r,i)=>G(e,{index:t,data:r,width:i})),F=W((e,t)=>({position:"relative",width:"100%",maxWidth:"100%",height:Math.ceil(t),maxHeight:Math.ceil(t),willChange:e?"contents":void 0,pointerEvents:e?"none":void 0})),D=(e,t)=>e[0]===t[0]&&e[1]===t[1],J=W((e,t)=>Object.assign({},e,t),D),Q=W(e=>({width:e,zIndex:-1e3,visibility:"hidden",position:"absolute",writingMode:"horizontal-tb"}),(e,t)=>e[0]===t[0]),U=W((e,t)=>r=>i=>{null!==i&&(t&&(t.observe(i),E.set(i,r)),void 0===e.get(r)&&e.set(r,i.offsetHeight))},D),V=[],X=k([WeakMap],(e,t)=>{var r=S(r=>{for(var i=[],o=0;o<r.length;o++){var n=r[o],a=n.target.offsetHeight;if(a>0){var s=E.get(n.target);if(void 0!==s){var l=e.get(s);void 0!==l&&a!==l.height&&i.push(s,a)}}}i.length>0&&(e.update(i),t(i))}),i=new j(r),o=i.disconnect.bind(i);return i.disconnect=()=>{o(),r.cancel()},i}),Y={low:0,max:0,high:0,C:2,P:void 0,R:void 0,L:void 0,list:void 0};Y.P=Y,Y.L=Y,Y.R=Y;var Z=function(e,t,r){void 0===r&&(r=0);for(var i=d(),o=new Array(e),n=[],a=new Array(e),s=0;e>s;s++)o[s]=0,a[s]=[];return{columnCount:e,columnWidth:t,set:function(e,s){void 0===s&&(s=0);for(var l=0,h=1;h<o.length;h++)o[h]<o[l]&&(l=h);var v=o[l]||0;o[l]=v+s+r,a[l].push(e),n[e]={left:l*(t+r),top:v,height:s,column:l},i.insert(v,v+s,e)},get:e=>n[e],update:t=>{for(var s=new Array(e),l=0,h=0;l<t.length-1;l++){var v=t[l],u=n[v];u.height=t[++l],i.remove(v),i.insert(u.top,u.top+u.height,v),s[u.column]=void 0===s[u.column]?v:Math.min(v,s[u.column])}for(l=0;l<s.length;l++)if(void 0!==s[l]){var f=a[l],d=$(f,s[l]),c=a[l][d],m=n[c];for(o[l]=m.top+m.height+r,h=d+1;h<f.length;h++){var p=f[h],g=n[p];g.top=o[l],o[l]=g.top+g.height+r,i.remove(p),i.insert(g.top,g.top+g.height,p)}}},range:(e,t,r)=>i.search(e,t,(e,t)=>r(e,n[e].left,t)),estimateHeight:(t,r)=>{var n=Math.max(0,Math.max.apply(null,o));return t===i.size?n:n+Math.ceil((t-i.size)/e)*r},shortestColumn:()=>o.length>1?Math.min.apply(null,o):o[0]||0,size:()=>i.size}},$=(e,t)=>{for(var r=0,i=e.length-1;i>=r;){var o=r+i>>>1,n=e[o];if(n===t)return o;n>t?i=o-1:r=o+1}return-1},_=function(e,t,r,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=8),i=i||Math.floor(e/(t+r))||1,[Math.floor((e-r*(i-1))/i),i]},ee=[],te={index:void 0,position:void 0,prevTop:void 0},re=R,ie=R,oe=(e,t)=>void 0!==t[e],ne={};export{g as List,p as Masonry,n as MasonryScroller,d as createIntervalTree,Z as createPositioner,X as createResizeObserver,a as useContainerPosition,P as useInfiniteLoader,i as useMasonry,c as usePositioner,s as useResizeObserver,m as useScrollToIndex,t as useScroller};
//# sourceMappingURL=index.mjs.map
